---
import "$styles/theme.css";
import Layout from "$layouts/Layout.astro";
import NotFoundPage from "./404.astro";
import { getCollection, getEntryBySlug } from 'astro:content';

export async function getStaticPaths() {
const posts = await getCollection('news');
    return posts.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug('news', slug);

const { data } = entry;
let contentHtml = entry.rendered.html ?? entry.rendered.html ?? 'No content';
---

<Layout pageTitle={data.title}>
    <article>
        <div class="article-header">
            <h1 class="article-title">{data.title}</h1>
            <a class="article-date"> <!-- vibes with chatgpt -->
                {data.date && (
                <time dateTime={data.date.toISOString()}>
                    {data.date.toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                    year: "numeric",
                    }).replace(",", "")
                    .replace(/(\d+)/, d => {
                    const n = parseInt(d, 10);
                    const suffix = n % 10 === 1 && n !== 11 ? "st"
                    : n % 10 === 2 && n !== 12 ? "nd"
                    : n % 10 === 3 && n !== 13 ? "rd"
                    : "th";
                    return `${n}${suffix}`;
                    })}
                </time>
                )}
            </a>
        </div>
        <div class="title-spacer"></div>


        <div class="article-content" set:html={contentHtml}></div>
    </article>
</Layout>


<style>
    article {
        margin: 50px;
    }

    .title-spacer {
        background-color: var(--border-bg);
        width: 100%;
        height: 1px;

        margin: 5px 0px 5px 0px;
    }

    .article-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        flex-wrap: wrap;
    }

    .article-title {
        flex: 1 1 auto;
        min-width: 0;

        margin-top: 10px;
        margin-bottom: 10px;
    }

    .article-date {
        white-space: nowrap;
        flex: 0 0 auto;
        margin-bottom: 10px;

        font-size: 0.9em;
        color: var(--text-gray);
    }

    :global(.article-content img) {
        max-width: 100%;
        height: auto;
        display: block;
    }

        
</style>
